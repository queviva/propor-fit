<!doctype html><html lang="en">
<head><title>propr fit</title>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
<link rel="icon" type="image/x-icon" href="../favicon.ico">
<style id="bodyStyles">

@font-face {
    font-family : luckiest;
    src : url(luckiest.ttf);
}
    
* {
    box-sizing: border-box;
    word-wrap: break-word;
}

body[data-vars] {
    
    --nose-h: 20;
    --nose-s: 100%;
    --nose-l: 90%;
    --nose-a: 1;
    
    --lightness: hsl( var(--nose-h), var(--nose-s), var(--nose-l));
    --midness: hsl( var(--nose-h), var(--nose-s),
    calc(0.5 * var(--nose-l))
    );
    --midness-x: hsl( var(--nose-h), var(--nose-s), calc(0.5 * var(--nose-l)),0.5);
    --darkness: hsl( var(--nose-h), var(--nose-s), calc(0.35 * var(--nose-l)));
    --darkness-x: hsl( var(--nose-h), var(--nose-s), calc(0.35 * var(--nose-l)),0.5);
    --blackness: hsl( var(--nose-h), var(--nose-s), calc(0.16 * var(--nose-l)));
    --whiteness: hsl( var(--nose-h), var(--nose-s), 90%);
    --greyness: hsl( var(--nose-h), 0%, 60%);
    
    --body-back: #000;
    --scene-back: #111;
    --trans-dur: 500ms;
    
}

body {
    
    padding: 10px;
    margin: 0;
    background-color: var(--body-back);
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    overscroll-behavior: none;
    
}

[data-port] { display: none; }

[data-land] { display: none; }

@media screen and (orientation: portrait) {
    [data-port] { display: inline-block; }
}

@media screen and (orientation: landscape) {
    [data-land] { display: inline-block; }
}

</style>
<style id="frameStyles">

#frame {
    position: relative;
    width: 100%;
    height: 100%;
    background-color: var(--greyness);
    overflow: hidden;
    border: 2px solid red;
}

#frame > div {
    position: absolute;
    width: 100%;
    height: 100%;
    border: 2px solid green;
}

#frame .deploy {
    left: 0%;
    
}

</style>
<style id="nitroStyles">

#nitro {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    left: 0%;
    background-color: var(--greyness);
    user-select: none;
    transition: left linear var(--trans-dur);
}

#nitro > div {
    position: absolute;
    border: 2px solid blue;
}

#nitro > div:nth-of-type(1) {
    
    display: block;
    align-items: none;
    justify-content: none;
    width: 100%;
    font-family: luckiest;
    font-size: 80px;
    text-align: center;
    letter-spacing: -.05em;
    color: var(--lightness);
    -webkit-text-stroke: 2px var(--darkness);
    opacity: 0.05;
    transform: rotate(-20deg);
    
}

#nitro > div:nth-of-type(2) {
    padding: 20px;
    width: 100%;
    hyphens: auto;
    text-align: center;
    font-size: 10px;
    color: var(--blackness);
}


</style>
<style id="statsStyles">

#stats {
    left: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--greyness);
    transition: left linear var(--trans-dur);
    user-select: none;
}

#stats div {
    display: flex;
    align-items: center;
    justify-content: center;
}

#stats > div {
    border: 2px solid blue;
}

#stats > div:nth-of-type(2) > div {
    border: 2px solid orange;
}

@media (orientation: landscape) {
    
    #stats {
        flex-direction: row;
    }

    #stats > div:nth-of-type(1) {
        width: 80%;
        height: 100%;
    }

    #stats > div:nth-of-type(2) {
        flex-direction: column;
        width: 20%;
        height: 100%;
    }

    #stats > div:nth-of-type(2) > div {
        height: 50%;
        width: 100%;
    }

}

@media (orientation: portrait) {
    
    #stats {
        flex-direction: column;
    }

    #stats > div:nth-of-type(1) {
        width: 100%;
        height: 80%;
    }

    #stats > div:nth-of-type(2) {
        flex-direction: row-reverse;
        width: 100%;
        height: 20%;
    }

    #stats > div:nth-of-type(2) > div {
        height: 100%;
        width: 50%;
    }

}
</style>
<style id="chartStyles">

#chart > path {
    fill: none;
    stroke-width: 2px;
    stroke: var(--lightness);
    vector-effect: non-scaling-stroke;
}

</style>
<style id="sButtStyles">

#shape_butt {
    height: 100%;
    width: 100%;
    overflow: visible;
    border: 2px solid orange;
}

#shape_butt > path {
    fill: url(#shape_pattern);
    stroke-width: 3px;
    stroke: var(--blackness);
    vector-effect: non-scaling-stroke;
    transition: d linear var(--trans-dur), transform cubic-bezier(.2, .3, .7, 1.5) var(--trans-dur);
}

</style>
<style id="pButtStyles">

#proprButt {
    height: 100%;
    width: 100%;
    overflow: visible;
    border: 2px solid orange;
}

#propr_butt_group {
    pointer-events: bounding-box;
}

#propr_butt_group > path {
    fill: url(#propr_pattern);
    stroke-width: 3;
    stroke: var(--blackness);
    vector-effect: non-scaling-stroke;
    pointer-events: bounding-box;
    transform-origin: 20px 25px;
    opacity: 0;
    transform: scale(0);
    transition: opacity linear var(--trans-dur), transform linear calc(0.8 * var(--trans-dur));
}

#propr_butt_group > path.show {
    opacity: 1;
    transform: scale(0.5);
    transition: transform cubic-bezier(.2, .3, .6, 1.5) var(--trans-dur);
}

</style>
<style id="sceneStyles">

#scene {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
}

#scene > div, #scene > svg {
    position: absolute;
    border: 2px solid blue ;
}

#sceneSVG {
    height: 100%;
    width: 100%;
}

#sceneSVG path {
    vector-effect: non-scaling-stroke;
    transition: all linear var(--trans-dur);
}

</style>
<style id="propr_groupStyles">


#propr_group > path {
    fill: var(--lightness);
    stroke-width: 3;
    stroke: var(--midness);
    vector-effect: non-scaling-stroke;
    opacity: 0;
    transform-origin: 20px 25px;
    transform: scale(0);
    transition: opacity cubic-bezier(.2, .3, .7, 1.4) var(--trans-dur), transform cubic-bezier(.2, .3, .7, 1.4) var(--trans-dur), fill linear var(--trans-dur);
}

#propr_group > path.show {
    opacity: 1;
    transform: scale(1.5);
}

</style>
</head>

<body data-vars>
    <div id="frame">
        <div id="scene">
            <svg id="sceneSVG"
             viewBox="-50 -50 100 100"
             preserveAspectRatio="xMaxYMid"
             style="width:100px;height:100px;overflow:visible;"
            >
              <defs>
                  
                <pattern id="shape_pattern" x="0" y="0"
                 width="2" height="2"
                 patternUnits="userSpaceOnUse"
                 patternTransform="scale(0.15) rotate(45)"
                >
                    <path id="sub_shape_pattern" d="M0 0H2V2H0Z" fill="var(--midness)" />
                    <path d="M0 0H1V2H0Z" fill="var(--midness)" />
                </pattern>
                                  
                <pattern id="propr_pattern" x="0" y="0"
                 width="2" height="2"
                 patternUnits="userSpaceOnUse"
                 patternTransform="scale(2) rotate(45)"
                >
                    <path id="sub_propr_pattern" d="M0 0H2V2H0Z" fill="var(--midness)" />
                    <path d="M0 0H1V2H0Z" fill="var(--midness)" />
                </pattern>
                
                <marker id="dotmark"
                     viewBox="-1 -1 2 2"
                     markerWidth="3"
                     markerHeight="3"
                >
                    <circle r="1" fill="var(--midness)" />
                </marker>
                               
                <marker id="lockmark"
                     viewBox="-1 -1 2 2"
                     markerWidth="3"
                     markerHeight="3"
                >
                    <circle r="1"
                    stroke-width="1"
                    stroke="var(--blackness)"
                    fill="var(--whiteness)"
                    />
                </marker>
                
              </defs>

              <path id="target_path"
               d="M0 -1 1.155 1 -1.155 1Z"
               fill="var(--midness)"
               stroke-width="3"
               stroke="var(--blackness)"
              />

              <g id="propr_group" transform="scale(1) translate(-20 -25)" >
                  
                <path d="M 25 4 Q 16 24 11 45 L 8 40 Q 16 20 21 1 L 21 1 Z M 18 25 C 34 8 50 32 30 40 L 40 40 L 38 50 L 21 50 L 20 40 C 30 40 29 30 23 36 Z M 6 0 L 11 5 L 11 30 L 5 34 L 5 12 L 0 9 Z" />

                <path d="M 20 0 L 25 5 Q 23 27 25 38 L 29 37 L 30 46 L 15 50 L 12 42 L 17 40 Q 16 27 17 13 L 15 15 L 11 9 Q 15 4 20 0 Z" />

                <path d="M 0 10 C 30 -17 60 20 20 35 L 40 35 L 38 50 L 2 50 L 0 35 C 10 35 27 27 23 22 C 19 19 12 25 10 27 Z" />

                <path d="M 3 1 Q 20 -1 39 1 L 37 16 Q 33 16 30 18 C 42 25 42 38 35 45 S 5 55 0 30 L 15 20 C 15 22 21 30 25 25 S 21 20 20 20 Q 25 18 26 15 Q 14 15 5 17 Q 3 10 3 1 Z" />

              </g>


              <g id="guess_scale"
                transform="scale(50)"
              >
              <path id="guess_path"
               d="M0 -1 1.155 1 -1.155 1Z"
               fill="var(--midness-x)"
               stroke-width="3"
               xxx-stroke-linejoin="round"
               stroke="var(--blackness)"
               transform="rotate(20)"
               />
              </g>

              
            </svg>
        </div>
        <div id="stats">
            <div>
                <svg id="chart"
                 viewBox="0 -50 100 100"
                 preserveAspectRatio="xMaxYMid"
                >
                    <path d="
M 5 0 15 0 25 0 35 0 45 0 55 0 65 0 75 0 85 0 95 0
                    "
                     marker-start="url(#dotmark)"
                     marker-mid="url(#dotmark)"
                     marker-end="url(#dotmark)"
                    />
                </svg>
            </div>
            <div>
              <svg id="shape_butt"
               viewBox="-2 -2 4 4"
               preserveAspectRatio="xMidYMid"
              >
               <path id="shape_path" />
              </svg>
              <svg id="proprButt" viewBox="0 0 40 50">
                        
                <g id="propr_butt_group">
                  
                      <path d="M 25 4 Q 16 24 11 45 L 8 40 Q 16 20 21 1 L 21 1 Z M 18 25 C 34 8 50 32 30 40 L 40 40 L 38 50 L 21 50 L 20 40 C 30 40 29 30 23 36 Z M 6 0 L 11 5 L 11 30 L 5 34 L 5 12 L 0 9 Z" />

                      <path stroke-miterlimit="300" d="M0 0ZM40 50ZM 20 0 L 26 5 Q 24 27 26 37 L 30 36 L 31 46 L 14 50 L 11 41 L 16 39 Q 15 27 16 13 L 15 15 L 10 9 Q 15 4 20 0 Z" />

                      <path d="M 0 10 C 30 -17 60 20 20 35 L 40 35 L 38 50 L 2 50 L 0 35 C 10 35 27 27 23 22 C 19 19 12 25 10 27 Z" />

                      <path d="M 3 1 Q 20 -1 39 1 L 37 16 Q 33 16 30 18 C 42 25 42 38 35 45 S 5 55 0 30 L 15 20 C 15 22 21 30 25 25 S 21 20 20 20 Q 25 18 26 15 Q 14 15 5 17 Q 3 10 3 1 Z" />

                </g>

	          </svg>
            </div>
        </div>
        <div id="nitro">
            <div>
                PROPR
                <br data-port>
                <b>&middot;</b> FIT
                <b data-port>&middot;</b>
            </div>
            <div>
                drag left&#8209;and&#8209;right to resize the middle shape until, in your opinion, it represents the specified proportion of the target shape
                <br><br> click for the next turn, or just click
                <i>without resizing</i> to skip that turn
                <br><br>
                <br data-port>
                <div style="
                    width: 100%;
                    text-align:center;
                    font-family: luckiest;
                    font-size: 2em;
                    
                ">
                    double click to begin
                    <br>
                    <span style="font-size:0.4em;">
                        [also to view stats]
                    </span>
            </div>
        </div>
    </div>
    </div>
</body>

<script>
//////////////////////////////////////////////////
// pizzaFace - MCMLXXXVIII                  /{
//
// DEBUGG
'use strict'
const log = console.log;
localStorage.clear();
//}

new Date() < new Date('2028-10-13') && (() => {
document.addEventListener('DOMContentLoaded', () => {
    
// vars and utils {

const
appName = 'propFit',
D = document,
O = Object,
W = window,
A = O.assign,
J = v => JSON.parse(v||'{}'),
WAL = (...v) => W.addEventListener(...v),
EDBL = v => v.addEventListener('dblclick', e => {
    e.stopPropagation(); e.preventDefault();
}, { passive: false }),
rand = v => ~~([...crypto.getRandomValues(
    new Uint32Array(1))
].map(v => v / 4294967296.5)[0] * v)
;

//}

// prefs {

const prefs = A({},{

    guess : 0,
    stats : {
        
    },
    hue : 20,
    shapeLock : false,
    proprLock : false

},J(localStorage.appName));

//}

// shape class {
    
const Triangle = new class {

    #check = [
        `'M 9 27 L 14 17 L 14 17 Q 14 17 14 17 L 9 27 Q 9 27 9 27 Q 14 37 9 27 Z'`,
        `'M 9 27 L 14 17 L 22 33 Q 22 33 22 33 L 23.25 46 Q 23.25 46 23.25 46 Q 14 37 9 27 Z'`,
        `'M 9 27 L 14 17 L 22 33 Q 27 10 38 -8 L 44 2 Q 32 15.25 23.25 46 Q 14 37 9 27 Z'`
    ];
    
    
    #shapes = [

    // triangle
    //`M 0 -1 L 0 -1 A 0 0  0 0 1  0 -1 L 0 -1 L .866 .5 L 0 .5 A 0 0  0 0 1  0 .5 L -.866 .5 Z `,

    //`M 0 -1 L 0 -1 A 0 0  0 0 1  0 -1 L 0 -1 L 1.155 1 L 0 1 A 0 0  0 0 1  0 1 L -1.155 1 Z `,

    //`M 0 -1.5 L 0 -1.5 A 0 0  0 0 1  0 -1.5 L 0 -1.5 L 1.299 .75 L 0 .75 A 0 0  0 0 1  0 .75 L -1.299 .75 Z `,

    `M 0 -1.25 L 0 -1.25 A 0 0  0 0 1  0 -1.25 L 0 -1.25 L 1.083 .625 L 0 .625 A 0 0  0 0 1  0 .625 L -1.083 .625 Z `,

    // square
    `M -1 -1 L 0 -1 A 0 0  0 0 1  0 -1 L 1 -1 L 1 1 L 0 1 A 0 0  0 0 1  0 1 L -1 1 Z `,
    
    // hexaberg
    `M -.866 -.5 L 0 -1 A 0 0  0 0 1  0 -1 L .866 -.5 L .866 .5 L 0 1 A 0 0  0 0 1  0 1 L -.866 .5 Z `,

    // circle
    `M -1 0 L -1 0 A 1 1  0 0 1  1 0 L 1 0 L 1 0 L 1 0 A 1 1 0 0 1 -1 0 L -1 0 Z `,

    // rectangle
    `M -1.414 -1 L 0 -1 A 0 0  0 0 1  0 -1 L 1.414 -1 L 1.414 1 L 0 1 A 0 0  0 0 1  0 1 L -1.414 1 Z `

    ];

    #shapeIdx = 0;
    
    #incShape (v) {
        
        this.#shapeIdx = (this.#shapeIdx + (
            1 + (v > 0 ? rand(this.#shapes.length - 1) : 0)
        )) % this.#shapes.length;
    
        return this.#shapes[this.#shapeIdx];
    }

    nextShape () { return this.#incShape(0); }
    randShape () { return this.#incShape(1); }
    get curShape () { return this.#shapes[this.#shapeIdx]; }
    get allShapes () { return this.#shapes; }
    
    
    #proprs = [
	"M 25 4 Q 16 24 11 45 L 8 40 Q 16 20 21 1 L 21 1 Z M 18 25 C 34 8 50 32 30 40 L 40 40 L 38 50 L 21 50 L 20 40 C 30 40 29 30 23 36 Z M 6 0 L 11 5 L 11 30 L 5 34 L 5 12 L 0 9 Z ",

	"M 20 0 L 25 5 Q 23 27 25 38 L 29 37 L 30 46 L 15 50 L 12 42 L 17 40 Q 16 27 17 13 L 15 15 L 11 9 Q 15 4 20 0 Z",

	"M 0 10 C 30 -17 60 20 20 35 L 40 35 L 38 50 L 2 50 L 0 35 C 10 35 27 27 23 22 C 19 19 12 25 10 27 Z",

	"M 3 1 Q 20 -1 39 1 L 37 16 Q 33 16 30 18 C 42 25 42 38 35 45 S 5 55 0 30 L 15 20 C 15 22 21 30 25 25 S 21 20 20 20 Q 25 18 26 15 Q 14 15 5 17 Q 3 10 3 1 Z"
    ];

    #proprIdx = 0;
    
    #incPropr (v) {
        
        this.#proprIdx = (this.#proprIdx + (
            1 + (v > 0 ? rand(this.#proprs.length - 1) : 0)
        )) % this.#proprs.length;
    
        return this.#proprs[this.#proprIdx];
    }
    
    nextPropr () { return this.#incPropr(0); }
    randPropr () { return this.#incPropr(1); }
    get curPropr () { return this.#proprIdx; }
    get allProprs () { return this.#proprs;  }

                     
}

class XXX {
    
    constructor (v) {
        this.list = (typeof v === 'object' && v.length) ? v : [];
    }
    
    list;
    #listIdx = 0;
    
    #incIdx (v) {
        
        let M = this.list.length;
        
        this.#listIdx = (((this.#listIdx + (
            (v === 'rand' ? (1 + rand(this.list.length - 1)) : v)
        )) % M) + M) % M;
    
        return this.list[this.#listIdx];
        
    }
    move (v=1) { return this.#incIdx(Number(v)); }
    rand () { return this.#incIdx('rand'); }
    get cur () { return this.list[this.#listIdx]; }
    set cur (v=0) {
        let M = this.list.length;
        this.#listIdx = ((v%M)+M)%M;
    }
}

const RAT = new XXX(['one','two','three','four','five']);
log(
    '\ncurr: ', RAT.cur,
    '\nset -3: ', (RAT.cur = -3),
    '\nso, cur is :', RAT.cur
);


//}

// setup on load {

Triangle.randShape();

[target_path, guess_path, shape_path].forEach(v => {
    v.setAttribute('d', Triangle.curShape);
});
    
//}

// handle next turn {

EDBL(guess_path);

guess_path.addEventListener('click', () => {

    if (!prefs.shapeLock) Triangle.randShape();
    
	    [target_path, guess_path, shape_path].forEach(v =>
        v.setAttribute('d', Triangle.curShape)
    );

    target_path.setAttribute('transform', `
        translate(
            ${(rand(2)<1?-1:1) * (sceneW+rand(adjustW))},
            ${(rand(2)<1?-1:1) * (sceneH+rand(adjustH))}
        )
        scale(${5 + rand(100)})
        rotate(${rand(500)})
    `);

    guess_path.setAttribute('transform', `rotate(${rand(500)})`);

    if (!prefs.proprLock) Triangle.randPropr();

    [...propr_group.children, ...propr_butt_group.children]
    .forEach(v => {
        v.classList.remove('show');
        v.classList.remove('fade');
    });

    propr_group.children[Triangle.curPropr].classList.add('show');
    
    propr_butt_group.children[Triangle.curPropr].classList.add('show');

    D.body.style.setProperty('--nose-h', (prefs.hue += 7));

});

//}
    
// shape button {

// choke double clicks on the shape itself
EDBL(shape_path);

// change shape on click of shape itself
shape_path.addEventListener('click', () => {
    if (prefs.shapeLock) return;
    Triangle.nextShape();
    [target_path, guess_path, shape_path].forEach(v => {
        v.setAttribute('d', Triangle.curShape);
    });

    D.body.style.setProperty('--nose-h', (prefs.hue += 7));

});

// lock shape on double click in button area
shape_butt.addEventListener('dblclick', e => {
    
    e.stopPropagation();
    e.preventDefault();
    prefs.shapeLock = !prefs.shapeLock;
    
    sub_shape_pattern.setAttribute('fill',
        prefs.shapeLock ? 'var(--whiteness)':'var(--midness)'
    );
    
    ['start', 'mid', 'end'].forEach(v => {
        shape_path.setAttribute('marker-' + v,
            prefs.shapeLock ? 'url(#lockmark)' : 'none'
        );
    });
    
}, { passive: false });

//}

// propr button {


// choke double clicks on the propr numbers and group
[...propr_butt_group.children, propr_butt_group].forEach(v => EDBL(v));

// change propr on click {
propr_butt_group.addEventListener('click', e => {
    
    e.stopPropagation();
    e.preventDefault();
    
    if (prefs.proprLock) return;

    Triangle.nextPropr();

    [...propr_group.children, ...propr_butt_group.children].forEach(v => {
        v.classList.remove('show');
        v.classList.remove('fade');
    });

    propr_group.children[Triangle.curPropr].classList.add('show');
    propr_butt_group.children[Triangle.curPropr].classList.add('show');

    D.body.style.setProperty('--nose-h', (prefs.hue += 7));

});

// lock propr on doubleclick of butt area
proprButt.addEventListener('dblclick', e => {
    
    e.stopPropagation();
    e.preventDefault();
    prefs.proprLock = !prefs.proprLock;
    
    sub_propr_pattern.setAttribute('fill',
        prefs.proprLock ? 'var(--whiteness)':'var(--midness)'
    );
    
},{ passive: false });

//}

//}

// toggle full-screen/chart on double click {

WAL('dblclick', e => {
    
    e.stopPropagation();
    e.preventDefault();
    
    nitro.style.left = '100%';

    guess_path.dispatchEvent(new Event('click'));
    
    //D.body.requestFullscreen().then((...x) => {
        
        D.body.style.width = '100vw';
        D.body.style.height = '100vh';
        
        WAL('dblclick', e => {
            
            e.stopPropagation();
            e.preventDefault();
            
            stats.classList.toggle('deploy');
            
        }, { passive: false });
    
    //});
    
    
}, { passive: false, once: true });

//}

// throttled re-set init vals {

let adjustW;
let adjustH;
let sceneW;
let sceneH;

const resetVals = () => {
    
    let BB = sceneSVG.getBBox();
    sceneW = BB.width /2;
    sceneH = BB.height/2;
    adjustW = (-1*((BB.width/2) + 5)) + parseInt(scene.offsetWidth /2);
    adjustH = (-1*((BB.height/2) + 5)) + parseInt(scene.offsetHeight/2);
    
}
resetVals();

let resizeThrottle;

WAL('resize', e => {
    clearTimeout(resizeThrottle);
    resizeThrottle = setTimeout(resetVals, 300);
});
    
//}

})})() === undefined || console.log('exp!red');
</script>
